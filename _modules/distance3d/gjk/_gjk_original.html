
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>distance3d.gjk._gjk_original &#8212; distance3d 0.6.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for distance3d.gjk._gjk_original</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>


<div class="viewcode-block" id="gjk_distance_original"><a class="viewcode-back" href="../../../_autosummary/distance3d.gjk.gjk_distance_original.html#distance3d.gjk.gjk_distance_original">[docs]</a><span class="k">def</span> <span class="nf">gjk_distance_original</span><span class="p">(</span><span class="n">collider1</span><span class="p">,</span> <span class="n">collider2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gilbert-Johnson-Keerthi (GJK) algorithm for distance calculation.</span>

<span class="sd">    The original implementation is quite slow, since the distance subalgorithm</span>
<span class="sd">    with the backup procedure is very slow in comparison to simpler, modern</span>
<span class="sd">    versions of the GJK algorithm.</span>

<span class="sd">    This is the original flavour of the GJK algorithm based on the translation</span>
<span class="sd">    to C of the original Fortran implementation:</span>
<span class="sd">    Ruspini, Diego. gilbert.c, a C version of the original Fortran</span>
<span class="sd">    implementation of the GJK algorithm.</span>
<span class="sd">    ftp://labrea.stanford.edu/cs/robotics/sean/distance/gilbert.c,</span>
<span class="sd">    also available from http://realtimecollisiondetection.net/files/gilbert.c</span>

<span class="sd">    The original publication describing the algorithm is:</span>
<span class="sd">    E.G. Gilbert, D.W. Johnson, S.S. Keerthi: A fast procedure for computing</span>
<span class="sd">    the distance between complex objects in three-dimensional space, IEEE</span>
<span class="sd">    Journal on Robotics and Automation (1988),</span>
<span class="sd">    https://graphics.stanford.edu/courses/cs448b-00-winter/papers/gilbert.pdf</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    collider1 : ConvexCollider</span>
<span class="sd">        Convex collider 1.</span>

<span class="sd">    collider2 : ConvexCollider</span>
<span class="sd">        Convex collider 2.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    distance : float</span>
<span class="sd">        The shortest distance between two convex shapes.</span>

<span class="sd">    closest_point1 : array, shape (3,)</span>
<span class="sd">        Closest point on first convex shape.</span>

<span class="sd">    closest_point2 : array, shape (3,)</span>
<span class="sd">        Closest point on second convex shape.</span>

<span class="sd">    simplex : array, shape (4, 3)</span>
<span class="sd">        Simplex defined by 4 points of the Minkowski difference between</span>
<span class="sd">        vertices of the two colliders.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">collider1</span> <span class="o">=</span> <span class="n">VertexCachedCollider</span><span class="p">(</span><span class="n">collider1</span><span class="p">)</span>
    <span class="n">collider2</span> <span class="o">=</span> <span class="n">VertexCachedCollider</span><span class="p">(</span><span class="n">collider2</span><span class="p">)</span>

    <span class="n">solution</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
    <span class="n">simplex</span> <span class="o">=</span> <span class="n">SimplexInfo</span><span class="p">()</span>
    <span class="n">old_simplex</span> <span class="o">=</span> <span class="n">SimplexInfo</span><span class="p">()</span>

    <span class="n">new_idx1</span><span class="p">,</span> <span class="n">new_vertex1</span> <span class="o">=</span> <span class="n">collider1</span><span class="o">.</span><span class="n">first_vertex</span><span class="p">()</span>
    <span class="n">new_idx2</span><span class="p">,</span> <span class="n">new_vertex2</span> <span class="o">=</span> <span class="n">collider2</span><span class="o">.</span><span class="n">first_vertex</span><span class="p">()</span>
    <span class="n">simplex</span><span class="o">.</span><span class="n">set_first_point</span><span class="p">(</span><span class="n">new_idx1</span><span class="p">,</span> <span class="n">new_idx2</span><span class="p">,</span> <span class="n">new_vertex1</span> <span class="o">-</span> <span class="n">new_vertex2</span><span class="p">)</span>

    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">backup</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">new_solution</span><span class="p">,</span> <span class="n">backup</span> <span class="o">=</span> <span class="n">distance_subalgorithm_with_backup_procedure</span><span class="p">(</span>
            <span class="n">simplex</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">backup</span><span class="p">)</span>

        <span class="n">no_improvement</span> <span class="o">=</span> <span class="n">new_solution</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&gt;=</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
        <span class="n">simplex_is_tetrahedron</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">no_improvement</span> <span class="ow">or</span> <span class="n">simplex_is_tetrahedron</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
                <span class="n">closest_point1</span> <span class="o">=</span> <span class="n">compute_point</span><span class="p">(</span>
                    <span class="n">collider1</span><span class="p">,</span> <span class="n">solution</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)],</span>
                    <span class="n">simplex</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)])</span>
                <span class="n">closest_point2</span> <span class="o">=</span> <span class="n">compute_point</span><span class="p">(</span>
                    <span class="n">collider2</span><span class="p">,</span> <span class="n">solution</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)],</span>
                    <span class="n">simplex</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)])</span>

                <span class="k">if</span> <span class="n">simplex_is_tetrahedron</span><span class="p">:</span>
                    <span class="c1"># Make sure intersection has zero distance</span>
                    <span class="n">closest_point1</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">closest_point1</span> <span class="o">+</span> <span class="n">closest_point2</span><span class="p">)</span>
                    <span class="n">closest_point2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">closest_point1</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">new_solution</span><span class="o">.</span><span class="n">distance</span>

                <span class="k">return</span> <span class="n">distance</span><span class="p">,</span> <span class="n">closest_point1</span><span class="p">,</span> <span class="n">closest_point2</span><span class="p">,</span> <span class="n">simplex</span><span class="o">.</span><span class="n">points</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">backup</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">simplex</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">old_simplex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solution</span> <span class="o">=</span> <span class="n">new_solution</span>

            <span class="n">_find_new_supporting_point</span><span class="p">(</span><span class="n">collider1</span><span class="p">,</span> <span class="n">collider2</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span>

            <span class="n">old_simplex</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">simplex</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="n">simplex</span><span class="o">.</span><span class="n">nondecreasing_ordered_indices</span><span class="p">())</span></div>


<span class="k">class</span> <span class="nc">VertexCachedCollider</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Caches vertices from a collider.</span>

<span class="sd">    Many colliders do not store their vertices explicitly. However, GJK only</span>
<span class="sd">    stores indices to the vertices. Hence, we will cache requested vertices</span>
<span class="sd">    of a collider here.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    collider : ConvexCollider</span>
<span class="sd">        Collider object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collider</span> <span class="o">=</span> <span class="n">collider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices_</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">first_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get vertex from collider to initialize GJK algorithm.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vertex_idx : int</span>
<span class="sd">            Index in vertex cache.</span>

<span class="sd">        vertex : array, shape (3,)</span>
<span class="sd">            Vertex from collider.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collider</span><span class="o">.</span><span class="n">first_vertex</span><span class="p">()</span>
        <span class="n">vertex_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vertex_idx</span><span class="p">,</span> <span class="n">vertex</span>

    <span class="k">def</span> <span class="nf">support_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_direction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Support function for collider.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        search_direction : array, shape (3,)</span>
<span class="sd">            Direction in which we search for support point of the collider.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vertex_idx : int</span>
<span class="sd">            Index in vertex cache.</span>

<span class="sd">        support_point : array, shape (3,)</span>
<span class="sd">            Extreme point along search direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collider</span><span class="o">.</span><span class="n">support_function</span><span class="p">(</span><span class="n">search_direction</span><span class="p">)</span>
        <span class="n">vertex_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vertex_idx</span><span class="p">,</span> <span class="n">vertex</span>


<span class="k">def</span> <span class="nf">_find_new_supporting_point</span><span class="p">(</span><span class="n">collider1</span><span class="p">,</span> <span class="n">collider2</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
    <span class="n">new_index1</span><span class="p">,</span> <span class="n">new_vertex1</span> <span class="o">=</span> <span class="n">collider1</span><span class="o">.</span><span class="n">support_function</span><span class="p">(</span><span class="o">-</span><span class="n">solution</span><span class="o">.</span><span class="n">search_direction</span><span class="p">)</span>
    <span class="n">new_index2</span><span class="p">,</span> <span class="n">new_vertex2</span> <span class="o">=</span> <span class="n">collider2</span><span class="o">.</span><span class="n">support_function</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">search_direction</span><span class="p">)</span>
    <span class="n">new_simplex_point</span> <span class="o">=</span> <span class="n">new_vertex1</span> <span class="o">-</span> <span class="n">new_vertex2</span>
    <span class="n">simplex</span><span class="o">.</span><span class="n">add_new_point</span><span class="p">(</span><span class="n">new_index1</span><span class="p">,</span> <span class="n">new_index2</span><span class="p">,</span> <span class="n">new_simplex_point</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compute_point</span><span class="p">(</span><span class="n">vertex_cache</span><span class="p">,</span> <span class="n">barycentric_coordinates</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute point from barycentric coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vertex_cache : VertexCachedCollider</span>
<span class="sd">        Collider that contains cached vertices.</span>

<span class="sd">    barycentric_coordinates : array, shape (n_vertices,)</span>
<span class="sd">        Barycentric coordinates of the point that we compute.</span>

<span class="sd">    indices : array, shape (n_vertices,)</span>
<span class="sd">        Vertex indices to which the barycentric coordinates apply.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    point : array, shape (3,)</span>
<span class="sd">        Point that we compute from barycentric coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">barycentric_coordinates</span><span class="p">,</span>
                  <span class="p">[</span><span class="n">vertex_cache</span><span class="o">.</span><span class="n">vertices_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents current best solution and search direction.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    search_direction : array, shape (3,)</span>
<span class="sd">        Near point to the convex hull of the points in simplex.</span>

<span class="sd">    barycentric_coordinates : array, shape (n_simplex_points,)</span>
<span class="sd">        The barycentric coordinates of search_direction, i.e.,</span>
<span class="sd">        search_direction = barycentric_coordinates[0]*simplex[1] + ...</span>
<span class="sd">        + barycentric_coordinates(n_simplex_points)*simplex[n_simplex_points-1],</span>
<span class="sd">        barycentric_coordinates[k] &gt; 0.0 for k=0,...,n_simplex_points-1, and,</span>
<span class="sd">        barycentric_coordinates[0] + ...</span>
<span class="sd">        + barycentric_coordinates[n_simplex_points-1] = 1.0.</span>

<span class="sd">    distance_squared : float</span>
<span class="sd">        Squared distance to origin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">vi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">vi</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">vi</span><span class="p">,</span> <span class="n">vi</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">from_line_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">vi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">coords_sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">coords_sum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">simplex</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">vi</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">vi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">coords_sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">coords_sum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">coords_sum</span>
        <span class="c1"># more stable floating point operation than c / coords_sum:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">simplex</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">vi</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">barycentric_coordinates</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">barycentric_coordinates</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">barycentric_coordinates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">simplex</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[:</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">solution</span><span class="o">.</span><span class="n">barycentric_coordinates</span><span class="p">[:</span><span class="n">n_simplex_points</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_direction</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">search_direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>


<span class="k">class</span> <span class="nc">SimplexInfo</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Simplex and additional data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    n_simplex_points : int</span>
<span class="sd">        Number of current simplex points.</span>

<span class="sd">    points : array, shape (n_simplex_points, 3)</span>
<span class="sd">      Current simplex.</span>

<span class="sd">    dot_product_table : array, shape (n_simplex_points, n_simplex_points)</span>
<span class="sd">        dot_product_table[i, j] = Inner product of simplex[i] and simplex[j].</span>
<span class="sd">        Note that only elements i &gt;= j are used.</span>

<span class="sd">    indices_polytope1 : array, shape (n_simplex_points,)</span>
<span class="sd">        Index vector for first polytope. For k = 1, ..., n_simplex_points,</span>
<span class="sd">        simplex[k] = vertices1[indices_polytope1[k]]</span>
<span class="sd">        - vertices2[indices_polytope2[k]].</span>

<span class="sd">    indices_polytope2 : array, shape (n_simplex_points,)</span>
<span class="sd">        Index vectors for first and second polytope. For k = 1, ...,</span>
<span class="sd">        n_simplex_points, simplex[k] = vertices1[indices_polytope1[k]]</span>
<span class="sd">        - vertices2[indices_polytope2[k]].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_first_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_index1</span><span class="p">,</span> <span class="n">new_index2</span><span class="p">,</span> <span class="n">new_simplex_point</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_index1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_index2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_simplex_point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">copy_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">points</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span>
            <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ordered_indices</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordered_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[</span><span class="n">ordered_indices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[</span><span class="n">ordered_indices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">ordered_indices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_new_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_index1</span><span class="p">,</span> <span class="n">new_index2</span><span class="p">,</span> <span class="n">new_simplex_point</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_move_first_point_to_last_spot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_first_point</span><span class="p">(</span><span class="n">new_index1</span><span class="p">,</span> <span class="n">new_index2</span><span class="p">,</span> <span class="n">new_simplex_point</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_move_first_point_to_last_spot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span><span class="p">]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_move_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_index</span><span class="p">,</span> <span class="n">new_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">old_index</span> <span class="o">==</span> <span class="n">new_index</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope1</span><span class="p">[</span><span class="n">old_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_polytope2</span><span class="p">[</span><span class="n">old_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">old_index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">select_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_move_vertex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">select_line_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_move_vertex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_move_vertex</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">select_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_move_vertex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_move_vertex</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="k">else</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_move_vertex</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="k">else</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="k">else</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">nondecreasing_ordered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># fast version of np.hstack(((0,), 1 + np.argsort(self.dot_product_table[1:, 0])))</span>
        <span class="n">ordered_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="n">ordered_indices</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_simplex_points</span>


<span class="k">def</span> <span class="nf">distance_subalgorithm_with_backup_procedure</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Johnson&#39;s distance subalgorithm.</span>

<span class="sd">    Implements, in a very efficient way, the distance subalgorithm of finding</span>
<span class="sd">    the point of minimum norm in the convex hull of four or less points</span>
<span class="sd">    in 3D space. The procedure and its efficient FORTRAN implementation</span>
<span class="sd">    are both due to D.W. Johnson. Although this subroutine is quite long,</span>
<span class="sd">    only a very small part of it will be executed on each call. Refer to</span>
<span class="sd">    sections 5 and 6 of the report mentioned in routine DIST3 for details</span>
<span class="sd">    concerning the distance subalgorithm. Converted to C be Diego C. Ruspini</span>
<span class="sd">    3/25/93.</span>

<span class="sd">    This function also determines an affinely independent subset of the</span>
<span class="sd">    points such that search_direction is a near point to the affine hull of</span>
<span class="sd">    the points in the subset. The variable simplex is modified so that, on</span>
<span class="sd">    output, it corresponds to this subset of points.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simplex : array, shape (n_simplex_points, 3)</span>
<span class="sd">        Current simplex.</span>

<span class="sd">    solution : Solution</span>
<span class="sd">        Represents current best solution and search direction.</span>

<span class="sd">    backup : bool, optional (default: False)</span>
<span class="sd">        Perform backup procedure.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    solution : Solution</span>
<span class="sd">        Current solution.</span>

<span class="sd">    backup : int</span>
<span class="sd">        Perform backup procedure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">BarycentricCoordinates</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">backup_procedure</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">backup</span><span class="p">),</span> <span class="n">backup</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">distance_subalgorithm</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">backup</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="n">backup</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">backup_procedure</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">backup</span><span class="p">),</span> <span class="n">backup</span>


<span class="k">class</span> <span class="nc">BarycentricCoordinates</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Barycentric coordinates.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    d : array, shape (4, 15)</span>
<span class="sd">        All barycentric coordinates of all vertices in all 15 cases. Each row</span>
<span class="sd">        corresponds to one vertex. The column index identifies one of the 15</span>
<span class="sd">        cases:</span>
<span class="sd">        * 0: vertex 0</span>
<span class="sd">        * 1: vertex 1</span>
<span class="sd">        * 2: line segment 0-1</span>
<span class="sd">        * 3: vertex 3</span>
<span class="sd">        * 4: line segment 0-2</span>
<span class="sd">        * 5: line segment 1-2</span>
<span class="sd">        * 6: face 0-1-2</span>
<span class="sd">        * 7: vertex 4</span>
<span class="sd">        * 8: line segment 0-3</span>
<span class="sd">        * 9: line segment 1-3</span>
<span class="sd">        * 10: line segment 2-3</span>
<span class="sd">        * 11: face 0-1-3</span>
<span class="sd">        * 12: face 0-2-3</span>
<span class="sd">        * 13: face 1-2-3</span>
<span class="sd">        * 14: tetrahedron 0-1-2-3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">line_segment_coordinates_0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">line_segment_coordinates_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">face_coordinates_0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_segment_coordinates_0</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">face_coordinates_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="n">e132</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_segment_coordinates_1</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">e132</span>

    <span class="k">def</span> <span class="nf">face_coordinates_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="n">e123</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">e123</span>
        <span class="k">return</span> <span class="n">e123</span>

    <span class="k">def</span> <span class="nf">face_coordinates_3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">):</span>
        <span class="n">e213</span> <span class="o">=</span> <span class="o">-</span><span class="n">e123</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">e213</span>
        <span class="k">return</span> <span class="n">e213</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_coordinates_0</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="n">e132</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">e142</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">e132</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">e142</span>
        <span class="k">return</span> <span class="n">e132</span><span class="p">,</span> <span class="n">e142</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="n">e123</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">e143</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">e123</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">e143</span>
        <span class="k">return</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e143</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e142</span><span class="p">,</span> <span class="n">e143</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">e213</span> <span class="o">=</span> <span class="o">-</span><span class="n">e123</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">e213</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">e142</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">e143</span>
        <span class="k">return</span> <span class="n">e213</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="n">e124</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">e134</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">e124</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">e134</span>
        <span class="k">return</span> <span class="n">e124</span><span class="p">,</span> <span class="n">e134</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">e124</span><span class="p">,</span> <span class="n">e132</span><span class="p">,</span> <span class="n">e134</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">e214</span> <span class="o">=</span> <span class="o">-</span><span class="n">e124</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">e214</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">e132</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">e134</span>
        <span class="k">return</span> <span class="n">e214</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e124</span><span class="p">,</span> <span class="n">e134</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">e314</span> <span class="o">=</span> <span class="o">-</span><span class="n">e134</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">e314</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">e123</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">e124</span>

    <span class="k">def</span> <span class="nf">tetrahedron_coordinates_7</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">,</span> <span class="n">e213</span><span class="p">,</span> <span class="n">e214</span><span class="p">):</span>
        <span class="n">e243</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">e243</span>
        <span class="n">e234</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">e234</span>
        <span class="n">e324</span> <span class="o">=</span> <span class="o">-</span><span class="n">e234</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">e324</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">e213</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">e214</span>

    <span class="k">def</span> <span class="nf">backup_line_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">backup_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_line_segments</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">e132</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">e132</span>
        <span class="n">e123</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_coordinates_2</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="n">e213</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_coordinates_3</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e132</span><span class="p">,</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e213</span>

    <span class="k">def</span> <span class="nf">backup_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex</span><span class="p">):</span>
        <span class="n">e132</span><span class="p">,</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e213</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_faces</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">e142</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">e142</span>
        <span class="n">e143</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">e143</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">e142</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">e143</span>
        <span class="n">e124</span><span class="p">,</span> <span class="n">e134</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tetrahedron_coordinates_4</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
        <span class="n">e214</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tetrahedron_coordinates_5</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e124</span><span class="p">,</span> <span class="n">e132</span><span class="p">,</span> <span class="n">e134</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tetrahedron_coordinates_6</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e124</span><span class="p">,</span> <span class="n">e134</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tetrahedron_coordinates_7</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e213</span><span class="p">,</span> <span class="n">e214</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vertex_0_of_line_segment_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">line_segment_01_of_line_segment_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_1_of_line_segment_optimal</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_0_of_line_segment_optimal</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">vertex_1_of_line_segment_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">vertex_0_of_face_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">line_segment_01_of_face_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_segment_01_of_line_segment_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">line_segment_02_of_face_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">face_012_of_face_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vertex_1_of_face_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vertex_2_of_face_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">line_segment_12_of_face_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_line_segment_12_of_face</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">vertex_0_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_0_of_face_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">line_segment_01_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_segment_01_of_face_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">line_segment_02_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_segment_02_of_face_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">face_012_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_012_of_face_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">EPSILON</span>

    <span class="k">def</span> <span class="nf">line_segment_03_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_line_segment_03_of_tetrahedron</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">face_013_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">EPSILON</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_face_013_of_tetrahedron</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">face_023_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">EPSILON</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_face_023_of_tetrahedron</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">convex_hull_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">EPSILON</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">EPSILON</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">EPSILON</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">EPSILON</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vertex_1_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_1_of_face_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">vertex_2_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_2_of_face_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">vertex_3_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">line_segment_12_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_segment_12_of_face_optimal</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">line_segment_13_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_line_segment_13_of_tetrahedron</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">line_segment_23_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_line_segment_23_of_tetrahedron</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">face_123_of_tetrahedron_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">EPSILON</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_face_123_of_tetrahedron</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">check_line_segment_02_of_face</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_face_012_of_face</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_line_segment_12_of_face</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_line_segment_03_of_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_face_013_of_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_face_023_of_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_line_segment_13_of_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_line_segment_23_of_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_face_123_of_tetrahedron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">distance_subalgorithm</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Johnson&#39;s distance subalgorithm.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_distance_subalgorithm_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_distance_subalgorithm_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">_distance_subalgorithm_tetrahedron</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_distance_subalgorithm_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
    <span class="n">d</span><span class="o">.</span><span class="n">line_segment_coordinates_0</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_0_of_line_segment_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">d</span><span class="o">.</span><span class="n">line_segment_coordinates_1</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_01_of_line_segment_optimal</span><span class="p">():</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_1_of_line_segment_optimal</span><span class="p">()</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>


<span class="k">def</span> <span class="nf">_distance_subalgorithm_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
    <span class="n">d</span><span class="o">.</span><span class="n">face_coordinates_0</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_0_of_face_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">d</span><span class="o">.</span><span class="n">face_coordinates_1</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_01_of_face_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">e123</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">face_coordinates_2</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_02_of_face_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">d</span><span class="o">.</span><span class="n">face_coordinates_3</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">face_012_of_face_optimal</span><span class="p">():</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_1_of_face_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_2_of_face_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_12_of_face_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">raise</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">(</span><span class="s2">&quot;Numerical problem, backup procedure required&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_distance_subalgorithm_tetrahedron</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
    <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_0</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_0_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">e132</span><span class="p">,</span> <span class="n">e142</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_1</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_01_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">e123</span><span class="p">,</span> <span class="n">e143</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_2</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_02_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">e213</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_3</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e142</span><span class="p">,</span> <span class="n">e143</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">face_012_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_face</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">e124</span><span class="p">,</span> <span class="n">e134</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_4</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_03_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">e214</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_5</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e124</span><span class="p">,</span> <span class="n">e132</span><span class="p">,</span> <span class="n">e134</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">face_013_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_face</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_6</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e123</span><span class="p">,</span> <span class="n">e124</span><span class="p">,</span> <span class="n">e134</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">face_023_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_face</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="n">d</span><span class="o">.</span><span class="n">tetrahedron_coordinates_7</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">e213</span><span class="p">,</span> <span class="n">e214</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">convex_hull_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_tetrahedron</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_1_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_2_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">vertex_3_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_vertex</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_12_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_13_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_23_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_line_segment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">face_123_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">simplex</span><span class="o">.</span><span class="n">select_face</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">raise</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">(</span><span class="s2">&quot;Numerical problem, backup procedure required&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">backup_procedure</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Backup procedure.</span>

<span class="sd">    Johnson&#39;s distance subalgorithm is affected by rounding errors in floating</span>
<span class="sd">    point operations in cases of degenerate simplices. This backup procedure</span>
<span class="sd">    addresses the problem. It will always succeed, but is computationally more</span>
<span class="sd">    expensive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ordered_indices</span> <span class="o">=</span> <span class="n">_backup_procedure_line_segment</span><span class="p">(</span>
            <span class="n">simplex</span><span class="p">,</span> <span class="n">backup</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ordered_indices</span> <span class="o">=</span> <span class="n">_backup_procedure_face</span><span class="p">(</span>
            <span class="n">simplex</span><span class="p">,</span> <span class="n">backup</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="n">ordered_indices</span> <span class="o">=</span> <span class="n">_backup_procedure_tetrahedron</span><span class="p">(</span>
            <span class="n">simplex</span><span class="p">,</span> <span class="n">backup</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span>

    <span class="n">simplex</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="n">ordered_indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">solution</span>


<span class="k">def</span> <span class="nf">_backup_procedure_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">backup</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">backup_line_segments</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="n">ordered_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1"># check vertex 1</span>
    <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_01_of_line_segment_optimal</span><span class="p">():</span>
        <span class="n">solution_d</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">check_vertex_2</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
    <span class="k">if</span> <span class="n">check_vertex_2</span><span class="p">:</span>
        <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">ordered_indices</span><span class="p">[:</span><span class="n">n_simplex_points</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_backup_procedure_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">backup</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">backup_faces</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="n">ordered_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1"># check vertex 1</span>
    <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">solution_d</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_01_of_line_segment_optimal</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_line_segment_02_of_face</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_face_012_of_face</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="n">check_vertex_2</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
    <span class="k">if</span> <span class="n">check_vertex_2</span><span class="p">:</span>
        <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">check_vertex_3</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
    <span class="k">if</span> <span class="n">check_vertex_3</span><span class="p">:</span>
        <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_line_segment_12_of_face</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">ordered_indices</span><span class="p">[:</span><span class="n">n_simplex_points</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_backup_procedure_tetrahedron</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">backup</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">backup_tetrahedron</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
    <span class="n">ordered_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1"># check vertex 1</span>
    <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">solution_d</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">line_segment_01_of_line_segment_optimal</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_line_segment_02_of_face</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_face_012_of_face</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_line_segment_03_of_tetrahedron</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_face_013_of_tetrahedron</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_face_023_of_tetrahedron</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">convex_hull_of_tetrahedron_optimal</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_tetrahedron</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">check_vertex_2</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
    <span class="k">if</span> <span class="n">check_vertex_2</span><span class="p">:</span>
        <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">check_vertex_3</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
    <span class="k">if</span> <span class="n">check_vertex_3</span><span class="p">:</span>
        <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">check_vertex_4</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">dot_product_table</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
    <span class="k">if</span> <span class="n">check_vertex_4</span><span class="p">:</span>
        <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">from_vertex</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ordered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_line_segment_12_of_face</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_line_segment_13_of_tetrahedron</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_line_segment_23_of_tetrahedron</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_line_segment</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">check_face_123_of_tetrahedron</span><span class="p">():</span>
        <span class="n">solution_d</span><span class="o">.</span><span class="n">from_face</span><span class="p">(</span><span class="n">simplex</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="n">d</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">])</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">solution_d</span><span class="o">.</span><span class="n">distance_squared</span> <span class="o">-</span> <span class="n">solution</span><span class="o">.</span><span class="n">distance_squared</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">n_simplex_points</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">n_simplex_points</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">solution</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">solution_d</span><span class="p">,</span> <span class="n">n_simplex_points</span><span class="p">)</span>
            <span class="n">ordered_indices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">ordered_indices</span><span class="p">[:</span><span class="n">n_simplex_points</span><span class="p">]</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">distance3d</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_auto_examples/index.html">Examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Alexander Fabisch.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>